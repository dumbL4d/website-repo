<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cash Flow Minimizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-dark: #181a23;
      --card-dark: #23263a;
      --accent: #30beb6;
      --text-light: #f4f4f7;
      --text-sub: #a3abb7;
      --danger: #ff5252;
      --shadow: 0 6px 24px rgba(48,190,182, 0.12);
    }

    body {
      background: var(--bg-dark);
      color: var(--text-light);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: fadein 1s;
    }
    @keyframes fadein {
      from { opacity: 0 }
      to { opacity: 1 }
    }

    h1 {
      color: var(--accent);
      margin-top: 36px;
      letter-spacing: 1px;
      text-shadow: 0 3px 12px #1b2727c3;
    }

    .card {
      background: var(--card-dark);
      border-radius: 18px;
      padding: 32px 32px 24px;
      box-shadow: var(--shadow);
      width: min(95vw,400px);
      margin: 24px 0;
      transition: box-shadow 0.3s;
      animation: slidein 0.7s;
    }
    @keyframes slidein {
      from {transform: translateY(32px); opacity: 0;}
      to   {transform: translateY(0); opacity: 1;}
    }

    label, input, button {
      font-size: 1.06em;
    }
    label {
      color: var(--text-sub);
      display: block;
      margin-bottom: 3px;
    }
    input[type="number"],
    input[type="text"] {
      width: 90%;
      padding: 8px;
      margin-bottom: 18px;
      background: #232838;
      color: var(--text-light);
      border: none;
      border-radius: 7px;
      transition: background 0.2s;
      outline: none;
    }
    input[type="number"]:focus,
    input[type="text"]:focus {
      background: #222d36;
    }
    button {
      background: var(--accent);
      color: var(--card-dark);
      border: none;
      border-radius: 7px;
      padding: 10px 22px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(48,190,182,0.07);
      margin: 0 3px;
      transition: transform 0.15s, background 0.2s;
    }
    button:hover {
      background: #25dfcf;
      transform: translateY(-1px) scale(1.03);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 18px 0;
    }
    th, td {
      padding: 8px 4px;
      text-align: center;
    }
    th {
      color: var(--accent);
      font-weight: 600;
      border-bottom: 1.5px solid #304357;
    }
    td {
      color: var(--text-light);
      border-bottom: 1px solid #232a36;
    }

    .result {
      background: #23263a;
      padding: 22px;
      border-radius: 13px;
      margin-top: 12px;
      animation: fadein 0.8s;
    }
    .result strong {
      color: var(--accent);
    }
    .danger {
      color: var(--danger);
      font-weight: bold;
    }
    @media (max-width: 520px) {
      .card { padding: 18px 4vw 12px; }
      h1 { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
  <h1>Cash Flow Minimizer</h1>
  <div class="card" id="setup-card">
    <form id="start-form">
      <label for="count-input">Participants</label>
      <input id="count-input" type="number" min="2" max="8" value="3" required>
      <button type="submit">Next ⟶</button>
    </form>
  </div>

  <div class="card" id="name-card" style="display:none"></div>
  <div class="card" id="matrix-card" style="display:none"></div>
  <div class="card" id="result-card" style="display:none"></div>

<script>
  const participants = [];
  let amounts = [];
  // Step 1: Get participant count
  document.getElementById('start-form').onsubmit = (e) => {
    e.preventDefault();
    const count = parseInt(document.getElementById('count-input').value, 10);
    if (count < 2 || count > 8) return alert('Must be between 2 and 8');
    showNamesInput(count);
    document.getElementById('setup-card').style.display = 'none';
  };

  // Step 2: Get participant names
  function showNamesInput(count) {
    const card = document.getElementById('name-card');
    let html = `<form id="names-form">`;
    for (let i=0; i<count; i++)
      html += `<label>Name #${i+1}</label>
        <input name="p${i}" type="text" maxlength="16" required autocomplete="off"/>`;
    html += `<button type="submit">Enter Flows ⟶</button></form>`;
    card.innerHTML = html;
    card.style.display = '';
    card.querySelector('form').onsubmit = (e) => {
      e.preventDefault();
      participants.length = 0;
      for (let i=0; i<count; i++) {
        let n = card.querySelector(`[name="p${i}"]`).value.trim();
        if (!n) return alert("No name left empty!");
        participants.push(n);
      }
      showMatrixInput();
      card.style.display = 'none';
    };
  }

  // Step 3: Enter cash flows matrix
  function showMatrixInput() {
    const N = participants.length;
    amounts = Array.from({length: N}, () => Array(N).fill(0));
    let html = `<form id="matrix-form"><table><tr><th></th>`;
    for (let j=0; j<N; j++) html += `<th>${participants[j]}</th>`;
    html += `</tr>`;
    for (let i=0; i<N; i++) {
      html += `<tr><th>${participants[i]}</th>`;
      for (let j=0; j<N; j++) {
        if (i === j) html += `<td>&mdash;</td>`;
        else
          html += `<td><input type="number" name="cell-${i}-${j}" min="0" max="99999" style="width:56px;" value="0"></td>`;
      }
      html += `</tr>`;
    }
    html += `</table>
      <button type="submit">Minimize Cash Flow</button></form>`;
    const card = document.getElementById('matrix-card');
    card.innerHTML = html;
    card.style.display = '';
    card.querySelector('form').onsubmit = (e) => {
      e.preventDefault();
      for (let i=0; i<N; i++)
        for (let j=0; j<N; j++)
          if (i !== j)
            amounts[i][j] = +card.querySelector(`[name="cell-${i}-${j}"]`).value || 0;
      showResults();
      card.style.display = 'none';
    };
  }

  // Step 4: Compute and display minimized transactions
  function showResults() {
    const N = participants.length;
    const net = Array(N).fill(0);
    for(let p=0; p<N; p++)
      for(let q=0; q<N; q++)
        net[p] += amounts[q][p] - amounts[p][q]; // net positive means they are owed money

    const transactions = [];
    function minCashFlowRec(net, names) {
      // Find cred (max creditor) and debt (max debtor)
      let mxCredit = net.reduce((maxidx, val, idx, arr) => val > arr[maxidx] ? idx : maxidx, 0);
      let mxDebt = net.reduce((minidx, val, idx, arr) => val < arr[minidx] ? idx : minidx, 0);
      if (Math.abs(net[mxCredit]) < 1e-2 && Math.abs(net[mxDebt]) < 1e-2)
        return;
      let amt = Math.min(-net[mxDebt], net[mxCredit]);
      net[mxCredit] -= amt;
      net[mxDebt] += amt;
      transactions.push({
        from: names[mxDebt],
        to: names[mxCredit],
        amount: amt
      });
      minCashFlowRec(net, names);
    }
    minCashFlowRec([...net], participants);

    let html = `<div class="result"><h3>Payment Plan</h3>`;
    if (transactions.length === 0) {
      html += `<div>All balances are already settled!</div>`;
    } else {
      html += `<ul>`;
      transactions.forEach(t =>
        html += `<li><strong>${t.from}</strong> pays <strong>₹${t.amount}</strong> to <strong>${t.to}</strong></li>`
      );
      html += `</ul>`;
    }
    html += `<button onclick="restart()">Restart</button></div>`;
    const card = document.getElementById('result-card');
    card.innerHTML = html;
    card.style.display = '';
  }
  // Restart flow
  function restart() {
    document.getElementById('result-card').style.display = 'none';
    document.getElementById('setup-card').style.display = '';
  }
</script>
</body>
</html>

